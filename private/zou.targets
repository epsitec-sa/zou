<?xml version="1.0" encoding="utf-8"?>
<!--
Import this script at the beginning of other scripts to define global zou properties:

  <Project ... >
    <ImportGroup Condition="'$(Zou)' == ''">
      <Import Project="private\zou.targets"/>
    </ImportGroup>
    ...
  </Project>


ZouDir     : the path of the 'zou' folder.
BundleName : the bundle name.
BundleDir  : the path of the bundle root folder.
  
The bundle folder is the one where `zou` and `git` repositories are located.
    
MSBuildThisFileDirectory = $(BundleDir)zou\private\zou.props

Fallback:
                Bundle Solution Project
  Zou1Dir :      1       1       1
  Zou2Dir :      1       *       1
  Zou3Dir :      1       1       *
  Zou4Dir :      1       *       *
  Zou5Dir :      *       1       1
  Zou6Dir :      *       *       1
  Zou7Dir :      *       1       *
  ZouDir  :      *       *       *

-->
<Project ToolsVersion="4.0" xmlns="http://schemas.microsoft.com/developer/msbuild/2003">
  <!-- Import semaphore -->
  <PropertyGroup> <Zou>zou</Zou> </PropertyGroup>
  
  <!-- Separators used for project and solution IDs generation (see ZouProjectId and ZouSolutionId). -->
  <PropertyGroup>
    <_ZouIdDirSep>@</_ZouIdDirSep>
    <_ZouIdSep>+</_ZouIdSep>
  </PropertyGroup>

  <PropertyGroup>
    <ZouDir>$([System.IO.Directory]::GetParent($(MSBuildThisFileDirectory)).Parent.FullName)\</ZouDir>
    <BundleName>$([System.IO.Directory]::GetParent($(MSBuildThisFileDirectory)).Parent.Parent.Name)</BundleName>
    <BundleDir>$([System.IO.Directory]::GetParent($(MSBuildThisFileDirectory)).Parent.Parent.FullName)\</BundleDir>
  </PropertyGroup>

  <!-- ZouBundleDir -->
  <PropertyGroup Condition="'$(ZouBundleDir)' == '' And Exists('$(BundleDir)zou.$(BundleName)\')" >
    <ZouBundleDir>$(BundleDir)zou.$(BundleName)\</ZouBundleDir>
  </PropertyGroup>
  <PropertyGroup Condition="'$(ZouBundleDir)' == ''" >
    <ZouBundleDir>$(BundleDir)zou.bundle\</ZouBundleDir>
  </PropertyGroup>

  <!-- Project properties -->
  <Choose>
    <When Condition="'$(ProjectName)' != '' And '$(ProjectName)' != '*Undefined*'">
      <!-- ZouProjectDir -->
      <PropertyGroup Condition="'$(ZouProjectDir)' == '' And Exists('$(ProjectDir)zou.$(ProjectFileName)\')" >
        <ZouProjectDir>$(ProjectDir)zou\$(ProjectFileName)\</ZouProjectDir>
      </PropertyGroup>
      <PropertyGroup Condition="'$(ZouProjectDir)' == '' And Exists('$(ProjectDir)zou.$(ProjectName)\')" >
        <ZouProjectDir>$(ProjectDir)zou\$(ProjectName)\</ZouProjectDir>
      </PropertyGroup>
      <PropertyGroup Condition="'$(ZouProjectDir)' == '' And Exists('$(ProjectDir)zou.project\')" >
        <ZouProjectDir>$(ProjectDir)zou\</ZouProjectDir>
      </PropertyGroup>
      <PropertyGroup Condition="'$(ZouProjectDir)' == ''" >
        <ZouProjectDir>$(ProjectDir)zou\$(ProjectFileName)\</ZouProjectDir>
      </PropertyGroup>

      <PropertyGroup>
        <BundleRelativeProjectPath>$([MSBuild]::MakeRelative($(BundleDir), $(ProjectPath)))</BundleRelativeProjectPath>
        <ZouProjectId>$(BundleRelativeProjectPath.Replace('\', $(_ZouIdDirSep)).Replace('/', $(_ZouIdDirSep)))</ZouProjectId>
        <Zou2Dir>$(ZouBundleDir)$(ZouProjectId)\</Zou2Dir>
        <Zou6Dir>$(ZouProjectDir)</Zou6Dir>
      </PropertyGroup>
    </When>
  </Choose>

  <!-- Solution properties -->
  <Choose>
    <When Condition="'$(SolutionName)' != '' And '$(SolutionName)' != '*Undefined*'">
      <!-- ZouSolutionDir -->
      <PropertyGroup Condition="'$(ZouSolutionDir)' == '' And Exists('$(SolutionDir)zou.$(SolutionFileName)\')" >
        <ZouSolutionDir>$(SolutionDir)zou\$(SolutionFileName)\</ZouSolutionDir>
      </PropertyGroup>
      <PropertyGroup Condition="'$(ZouSolutionDir)' == '' And Exists('$(SolutionDir)zou.$(SolutionName)\')" >
        <ZouSolutionDir>$(SolutionDir)zou\$(SolutionName)\</ZouSolutionDir>
      </PropertyGroup>
      <PropertyGroup Condition="'$(ZouSolutionDir)' == '' And Exists('$(SolutionDir)zou.solution\')" >
        <ZouSolutionDir>$(SolutionDir)zou\</ZouSolutionDir>
      </PropertyGroup>
      <PropertyGroup Condition="'$(ZouSolutionDir)' == ''" >
        <ZouSolutionDir>$(SolutionDir)zou\$(SolutionFileName)\</ZouSolutionDir>
      </PropertyGroup>
      
      <PropertyGroup>
        <BundleRelativeSolutionPath>$([MSBuild]::MakeRelative($(BundleDir), $(SolutionPath)))</BundleRelativeSolutionPath>
        <ZouSolutionId>$(BundleRelativeSolutionPath.Replace('\', $(_ZouIdDirSep)).Replace('/', $(_ZouIdDirSep)))</ZouSolutionId>
        <Zou3Dir>$(ZouBundleDir)$(ZouSolutionId)\</Zou3Dir>
        <Zou7Dir>$(ZouSolutionDir)</Zou7Dir>
      </PropertyGroup>
    </When>
  </Choose>

  <Choose>
    <When Condition="'$(SolutionName)' != '' And '$(SolutionName)' != '*Undefined*' And '$(ProjectName)' != '' And '$(ProjectName)' != '*Undefined*'">
      <PropertyGroup>
        <Zou1Dir>$(ZouBundleDir)$(ZouSolutionId)$(_ZouIdSep)$(ZouProjectId)\</Zou1Dir>
        <Zou5Dir>$(ZouSolutionDir)$(ZouProjectId)\</Zou5Dir>
      </PropertyGroup>
    </When>
  </Choose>

  <PropertyGroup>
    <Zou4Dir>$(ZouBundleDir)</Zou4Dir>
  </PropertyGroup>

  <ItemGroup>
    <_ZouLocalDirs Include="$(Zou1Dir)" Condition="'$(Zou1Dir)' != ''" />
    <_ZouLocalDirs Include="$(Zou2Dir)"  Condition="'$(Zou2Dir)' != ''" />
    <_ZouLocalDirs Include="$(Zou3Dir)"  Condition="'$(Zou3Dir)' != ''" />
    <_ZouLocalDirs Include="$(Zou5Dir)"  Condition="'$(Zou5Dir)' != ''" />
    <_ZouLocalDirs Include="$(Zou6Dir)"   Condition="'$(Zou6Dir)' != ''" />
  </ItemGroup>

  <Target Name="ZouMakeDirs">
    <MakeDir Directories="@(_ZouLocalDirs)" />
  </Target>
  
  <Target Name="ZouTraceGlobals">
    <Message Text="BundleName   = $(BundleName)" />
    <Message Text="SolutionName = $(SolutionName)" Condition="'$(SolutionName)' != ''" />
    <Message Text="ProjectName  = $(ProjectName)"  Condition="'$(ProjectName)' != ''" />

    <Message Text="%0A" />

    <Message Text="Configuration   = $(Configuration)"   Condition="'$(Configuration)' != ''" />
    <Message Text="Platform        = $(Platform)"        Condition="'$(Platform)' != ''"  />
    <Message Text="PlatformToolset = $(PlatformToolset)" Condition="'$(PlatformToolset)' != ''"  />
    <Message Text="OutDir          = $(OutDir)"          Condition="'$(OutDir)' != ''"  />
    <Message Text="IntDir          = $(IntDir)"          Condition="'$(IntDir)' != ''"  />

    <Message Text="%0A" />

    <Message Text="BundleDir    = $(BundleDir)" />
    <Message Text="SolutionDir  = $(SolutionDir)"  Condition="'$(SolutionDir)' != ''" />
    <Message Text="ProjectDir   = $(ProjectDir)"   Condition="'$(ProjectDir)' != ''" />
    <Message Text="SolutionPath = $(SolutionPath)" Condition="'$(SolutionPath)' != ''" />
    <Message Text="ProjectPath  = $(ProjectPath)"  Condition="'$(ProjectPath)' != ''" />

    <Message Text="%0A" />

    <Message Text="BundleRelativeSolutionPath = $(BundleRelativeSolutionPath)" Condition="'$(BundleRelativeSolutionPath)' != ''" />
    <Message Text="BundleRelativeProjectPath  = $(BundleRelativeProjectPath)"  Condition="'$(BundleRelativeProjectPath)' != ''" />

    <Message Text="%0A" />
    
    <Message Text="MSBuildBinPath                 = $(MSBuildBinPath)" />
    <Message Text="MSBuildExtensionsPath          = $(MSBuildExtensionsPath)" />
    <Message Text="MSBuildExtensionsPath32        = $(MSBuildExtensionsPath32)" />
    <Message Text="MSBuildExtensionsPath64        = $(MSBuildExtensionsPath64)" />
    <Message Text="MSBuildFrameworkToolsPath      = $(MSBuildFrameworkToolsPath)" />
    <Message Text="MSBuildLastTaskResult          = $(MSBuildLastTaskResult)" />
    <Message Text="MSBuildProjectDirectory        = $(MSBuildProjectDirectory)" />
    <Message Text="MSBuildProjectFile             = $(MSBuildProjectFile)" />
    <Message Text="MSBuildThisFile                = $(MSBuildThisFile)" />
    <Message Text="MSBuildThisFileDirectory       = $(MSBuildThisFileDirectory)" />
    <Message Text="MSBuildThisFileExtension       = $(MSBuildThisFileExtension)" />
    <Message Text="MSBuildThisFileFullPath        = $(MSBuildThisFileFullPath)" />
    <Message Text="MSBuildThisFileName            = $(MSBuildThisFileName)" />
    <Message Text="MSBuildToolsVersion            = $(MSBuildToolsVersion)" />
    <Message Text="MSBuildToolsPath               = $(MSBuildToolsPath)" />
    <Message Text="MSBuildThisFileDirectoryNoRoot = $(MSBuildThisFileDirectoryNoRoot)" />

    <Message Text="%0A" />
    
    <Message Text="VCTargetsPath = $(VCTargetsPath)" />
  </Target>
  
  <Target Name="ZouTraceFallback">
    <Message Text="ZouDir         = $(ZouDir)" />
    <Message Text="ZouBundleDir   = $(ZouBundleDir)" />
    <Message Text="ZouSolutionDir = $(ZouSolutionDir)" />
    <Message Text="ZouProjectDir  = $(ZouProjectDir)" />
    <Message Text="ZouSolutionId  = $(ZouSolutionId)" Condition="'$(ZouSolutionId)' != ''" />
    <Message Text="ZouProjectId   = $(ZouProjectId)"  Condition="'$(ZouProjectId)' != ''" />

    <Message Text="%0A" />

    <Message Text="Zou1Dir = $(Zou1Dir)" />
    <Message Text="Zou2Dir  = $(Zou2Dir)" />
    <Message Text="Zou3Dir  = $(Zou3Dir)" />
    <Message Text="Zou4Dir   = $(Zou4Dir)" />
    <Message Text="Zou5Dir  = $(Zou5Dir)" />
    <Message Text="Zou6Dir   = $(Zou6Dir)" />
    <Message Text="Zou7Dir   = $(Zou7Dir)" />
    <Message Text="ZouDir    = $(ZouDir)" />
  </Target>

  <Target Name="ZouTrace" DependsOnTargets="ZouTraceGlobals;ZouTraceFallback"/>
</Project>