<?xml version="1.0" encoding="utf-8"?>
<!--
Import this script at the beginning of other scripts to define global zou properties:

  <Project ... >
    <Import Condition="'$(Zou)' == ''" Project="private\zou.targets"/>
    ...
  </Project>


ZouDir     : the path of the 'zou' folder.
BundleName : the bundle name.
BundleDir  : the path of the bundle root folder.
  
The bundle folder is the one where `zou` and `git` repositories are located.
    
MSBuildThisFileDirectory = $(BundleDir)zou\private\zou.props
-->
<Project ToolsVersion="4.0" xmlns="http://schemas.microsoft.com/developer/msbuild/2003">
  <!-- Import semaphore -->
  <PropertyGroup> <Zou>zou</Zou> </PropertyGroup>
  
  <PropertyGroup>
    <!-- Configuration directory name -->
    <_ZouCfgSubdir>zou.cfg\</_ZouCfgSubdir>
  </PropertyGroup>

  <PropertyGroup>
    <ZouDir>$([System.IO.Directory]::GetParent($(MSBuildThisFileDirectory)).Parent.FullName)\</ZouDir>
    <BundleName>$([System.IO.Directory]::GetParent($(MSBuildThisFileDirectory)).Parent.Parent.Name)</BundleName>
    <BundleDir>$([System.IO.Directory]::GetParent($(MSBuildThisFileDirectory)).Parent.Parent.FullName)\</BundleDir>
  </PropertyGroup>

  <!-- ZouBundleDir -->
  <PropertyGroup Condition="'$(ZouBundleDir)' == ''" >
    <ZouBundleDir>$(BundleDir)$(_ZouCfgSubdir)</ZouBundleDir>
  </PropertyGroup>

  <!-- Project properties -->
  <Choose>
    <When Condition="'$(ProjectName)' != '' And '$(ProjectName)' != '*Undefined*'">
      <!-- ZouProjectDir -->
      <PropertyGroup Condition="'$(ZouProjectDir)' == ''" >
        <ZouProjectDir>$(ProjectDir)$(_ZouCfgSubdir)</ZouProjectDir>
      </PropertyGroup>

      <PropertyGroup>
        <BundleRelativeProjectPath>$([MSBuild]::MakeRelative($(BundleDir), $(ProjectPath)))</BundleRelativeProjectPath>
        <_ZouTmp>$(BundleRelativeProjectPath.IndexOf('\'))</_ZouTmp>
      </PropertyGroup>
      <PropertyGroup Condition="'$(_ZouTmp)' &gt; '0'" >
        <BundleProjectAnchor>$(BundleRelativeProjectPath.Substring(0, $(_ZouTmp)))\</BundleProjectAnchor>
      </PropertyGroup>
    </When>
  </Choose>

  <!-- Solution properties -->
  <Choose>
    <When Condition="'$(SolutionName)' != '' And '$(SolutionName)' != '*Undefined*'">
      <!-- ZouSolutionDir -->
      <PropertyGroup Condition="'$(ZouSolutionDir)' == ''" >
        <ZouSolutionDir>$(SolutionDir)$(_ZouCfgSubdir)</ZouSolutionDir>
      </PropertyGroup>

      <PropertyGroup>
        <BundleRelativeSolutionPath>$([MSBuild]::MakeRelative($(BundleDir), $(SolutionPath)))</BundleRelativeSolutionPath>
        <_ZouTmp>$(BundleRelativeSolutionPath.IndexOf('\'))</_ZouTmp>
      </PropertyGroup>
      <PropertyGroup Condition="'$(_ZouTmp)' &gt; '0'" >
        <BundleSolutionAnchor>$(BundleRelativeSolutionPath.Substring(0, $(_ZouTmp)))\</BundleSolutionAnchor>
      </PropertyGroup>
    </When>
  </Choose>
  
  <Target Name="ZouTrace">
    <Message Text="BundleDir      = $(BundleDir)"    />
    <Message Text="SolutionPath   = $(SolutionPath)" />
    <Message Text="ProjectPath    = $(ProjectPath)"  />

    <Message Text="ZouDir         = $(ZouDir)" />
    <Message Text="ZouBundleDir   = $(ZouBundleDir)"   />
    <Message Text="ZouSolutionDir = $(ZouSolutionDir)" />
    <Message Text="ZouProjectDir  = $(ZouProjectDir)"  />
    
    <Message Text="BundleName     = $(BundleName)"   />
    <Message Text="SolutionName   = $(SolutionName)" />
    <Message Text="ProjectName    = $(ProjectName)"  />
    <Message Text="SolutionDir    = $(SolutionDir)"  />
    <Message Text="ProjectDir     = $(ProjectDir)"   />

    <Message Text="%0A" />

    <Message Text="BundleRelativeSolutionPath = $(BundleRelativeSolutionPath)" />
    <Message Text="BundleRelativeProjectPath  = $(BundleRelativeProjectPath)"  />
    <Message Text="BundleSolutionAnchor       = $(BundleSolutionAnchor)"       />
    <Message Text="BundleProjectAnchor        = $(BundleProjectAnchor)"        />
    
    <Message Text="%0A" />

    <Message Text="Configuration   = $(Configuration)"   />
    <Message Text="Platform        = $(Platform)"        />
    <Message Text="PlatformToolset = $(PlatformToolset)" />
    <Message Text="OutDir          = $(OutDir)"          />
    <Message Text="IntDir          = $(IntDir)"          />
    <Message Text="TargetDir       = $(TargetDir)"       />

    <Message Text="%0A" />
    
    <Message Text="MSBuildBinPath                 = $(MSBuildBinPath)" />
    <Message Text="MSBuildExtensionsPath          = $(MSBuildExtensionsPath)" />
    <Message Text="MSBuildExtensionsPath32        = $(MSBuildExtensionsPath32)" />
    <Message Text="MSBuildExtensionsPath64        = $(MSBuildExtensionsPath64)" />
    <Message Text="MSBuildFrameworkToolsPath      = $(MSBuildFrameworkToolsPath)" />
    <Message Text="MSBuildLastTaskResult          = $(MSBuildLastTaskResult)" />
    <Message Text="MSBuildProjectDirectory        = $(MSBuildProjectDirectory)" />
    <Message Text="MSBuildProjectFile             = $(MSBuildProjectFile)" />
    <Message Text="MSBuildThisFile                = $(MSBuildThisFile)" />
    <Message Text="MSBuildThisFileDirectory       = $(MSBuildThisFileDirectory)" />
    <Message Text="MSBuildThisFileExtension       = $(MSBuildThisFileExtension)" />
    <Message Text="MSBuildThisFileFullPath        = $(MSBuildThisFileFullPath)" />
    <Message Text="MSBuildThisFileName            = $(MSBuildThisFileName)" />
    <Message Text="MSBuildToolsVersion            = $(MSBuildToolsVersion)" />
    <Message Text="MSBuildToolsPath               = $(MSBuildToolsPath)" />
    <Message Text="MSBuildThisFileDirectoryNoRoot = $(MSBuildThisFileDirectoryNoRoot)" />
    <Message Text="VCTargetsPath                  = $(VCTargetsPath)" />
  </Target>
</Project>