<?xml version="1.0" encoding="utf-8"?>
<Project ToolsVersion="4.0" DefaultTargets="Main" xmlns="http://schemas.microsoft.com/developer/msbuild/2003">

  <Target Name="Main">

    <!-- Bundle -->
    <PropertyGroup>
      <BundleDir>$([MSBuild]::GetDirectoryNameOfFileAbove($(MSBuildThisFileDirectory), '.git\HEAD'))</BundleDir>
      <BundleDir Condition="HasTrailingSlash('$(BundleDir)')">$(BundleDir.Substring(0, $(BundleDir.LastIndexOfAny('\/'))))</BundleDir>
      <BundleName>$([System.IO.Path]::GetFileName('$(BundleDir)'))</BundleName>
      <BundleDir>$(BundleDir)\</BundleDir>
    </PropertyGroup>

    <PropertyGroup>
      <ModuleId>$([MSBuild]::GetDirectoryNameOfFileAbove($(MSBuildThisFileDirectory), '.git'))</ModuleId>
    </PropertyGroup>
    <PropertyGroup Condition="'$(ModuleId)' != ''">
      <ModuleId>$([MSBuild]::MakeRelative($(BundleDir), $(ModuleId)))</ModuleId>
      <ModuleId Condition="HasTrailingSlash('$(ModuleId)')">$(ModuleId.Substring(0, $(ModuleId.LastIndexOfAny('\/'))))</ModuleId>
      <ModuleName>$(ModuleId)</ModuleName>
      <ModuleDir>$(BundleDir)$(ModuleId)\</ModuleDir>
    </PropertyGroup>

    <PropertyGroup Condition="'$(ModuleId)' == ''">
      <ModuleId>$(MSBuildThisFileDirectory)</ModuleId>
      <ModuleId>$([MSBuild]::MakeRelative($(BundleDir), $(ModuleId)))</ModuleId>
    </PropertyGroup>
    <PropertyGroup  Condition="'$(ModuleId)' != ''">
      <ModuleId Condition="HasTrailingSlash('$(ModuleId)')">$(ModuleId.Substring(0, $(ModuleId.IndexOfAny('\/'))))</ModuleId>
      <ModuleName>$([System.IO.Path]::GetFileName('$(ModuleId)'))</ModuleName>
      <ModuleDir>$(BundleDir)$(ModuleId)\</ModuleDir>
    </PropertyGroup>

    <Message Text="BundleName = $(BundleName)" Importance="high"/>
    <Message Text="BundleDir  = $(BundleDir)"  Importance="high"/>
    <Message Text="ModuleName = $(ModuleName)" Importance="high"/>
    <Message Text="ModuleId   = $(ModuleId)" Importance="high"/>
    <Message Text="ModuleDir  = $(ModuleDir)"  Importance="high"/>
  </Target>
</Project>