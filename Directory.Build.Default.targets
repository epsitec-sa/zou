<!-- Defines the default metadata for .NET projects (epilog) -->
<Project  InitialTargets="TraceDirectoryBuildDefaultTargets">

  <Import Project="Boot.Runtime.props" Condition="'$(BootRuntimeImported)' == ''"/>

  <PropertyGroup>
    <!-- Package default properties -->
    <AssemblyTitle Condition="'$(AssemblyTitle)' == ''">$(AssemblyName)</AssemblyTitle>
    <AssemblyTitle>$(AssemblyTitle) ($(RuntimeIdentifier).$(TargetFramework))</AssemblyTitle>
    <FirstCopyrightYear Condition="'$(FirstCopyrightYear)' == ''"></FirstCopyrightYear>
    <LastCopyrightYear Condition="'$(LastCopyrightYear)' == ''">$([System.DateTime]::Now.ToString(yyyy))</LastCopyrightYear>
    <CopyrightYears Condition="'$(CopyrightYears)' == '' And ('$(FirstCopyrightYear)' == '' Or '$(FirstCopyrightYear)' == '$(LastCopyrightYear)')">$(LastCopyrightYear)</CopyrightYears>
    <CopyrightYears Condition="'$(CopyrightYears)' == ''">$(FirstCopyrightYear)-$(LastCopyrightYear)</CopyrightYears>
    <Copyright Condition="'$(Copyright)' == ''">Copyright Â© $(CopyrightYears), EPSITEC SA, CH-1400 Yverdon-les-Bains, Switzerland</Copyright>
    <Authors Condition="'$(Authors)' == ''">$(Company)</Authors>
    <Product Condition="'$(Product)' == ''">$(AssemblyName)</Product>
    <Description Condition="'$(Description)' == ''">$(Product)</Description>
    <Description>$(Description) - $(Version) $(TargetFramework)</Description>
    <Description Condition="'$(RuntimeIdentifier)' != ''">$(Description)-$(RuntimeIdentifier)</Description>
    <DefaultLanguage Condition="'$(DefaultLanguage)' == ''">en-US</DefaultLanguage>
    <PackageId Condition="'$(PackageId)' == ''">$(ProjectName)</PackageId>
    <PackageId Condition="!$(PackageId.StartsWith('$(Company)'))">$(Company).$(PackageId)</PackageId>
    <DefaultPackageTags>$(PackageId.Replace('.', ';'))</DefaultPackageTags>
    <PackageTags Condition="'$(PackageTags)' != ''">$(DefaultPackageTags);$(PackageTags)</PackageTags>
    <PackageTags Condition="'$(PackageTags)' == ''">$(DefaultPackageTags)</PackageTags>
    <PackageTags >$(PackageTags.ToLower())</PackageTags>
    <RepositoryType Condition="'$(RepositoryType)' == ''">git</RepositoryType>
    <RepositoryUrl Condition="'$(RepositoryUrl)' == '' And '$(PackageProjectUrl)' != ''">$(PackageProjectUrl).$(RepositoryType)</RepositoryUrl>

    <!-- Suppress following C# warning because we use a subset of the semantic versioning format - major.minor.patch -->
    <!-- warning CS7035: The specified version string does not conform to the recommended format - major.minor.build.revision -->
    <NoWarn>$(NoWarn);7035</NoWarn>
    <!-- Suppress following C# warning because we use a a preview of C# 8.0 (VS 2019 and .NET Core 3.0 previews) -->
    <!-- warning CS8632: The annotation for nullable reference types should only be used in code within a '#nullable' context. -->
    <NoWarn>$(NoWarn);8632</NoWarn>
  </PropertyGroup>

  <PropertyGroup>
    <!--
    Avoid warning MSB3270: There was a mismatch between the processor architecture of the project being built "MSIL"
    and the processor architecture of the reference "...\bin\x64\Release\netstandard2.0\foo.dll", "AMD64"
    -->
    <PlatformTarget Condition="$(TargetFramework.StartsWith('netstandard'))" />
  </PropertyGroup>
  
  <!-- TargetFrameworks -->
  <PropertyGroup Condition="'$(TargetFrameworks)' == '*Undefined*' And '$(BuildingInsideVisualStudio)' != ''">
    <TargetFrameworks />
  </PropertyGroup>
  <PropertyGroup Condition="'$(TargetFrameworks)' == '*Undefined*' And '$(BuildingInsideVisualStudio)' == ''">
    <TargetFrameworks />
    <TargetFrameworks Condition="'$(TargetFrameworkImport)' == '$(FullTargetFramework)'">$(FullTargetFramework);netstandard2.0</TargetFrameworks>
    <TargetFrameworks Condition="'$(TargetFrameworkImport)' == '$(CoreTargetFramework)'">$(CoreTargetFramework);netstandard2.0;netstandard2.1</TargetFrameworks>
  </PropertyGroup>

  <!-- Exclude git metadata from project -->
  <ItemGroup>
    <None Remove=".git*" />
  </ItemGroup>

  <!-- Make assembly internals visible to test projects (MyProject visible to MyProject.Test[s]) -->
  <!-- Does not support signed assemblies -->
  <Target Name="AddInternalsVisibleToAttribute" BeforeTargets="GetAssemblyAttributes" Condition="!$(SignAssembly)">
    <ItemGroup>
      <AssemblyAttribute Include="System.Runtime.CompilerServices.InternalsVisibleTo">
        <_Parameter1>$(MSBuildProjectName).Test</_Parameter1>
      </AssemblyAttribute>
      <AssemblyAttribute Include="System.Runtime.CompilerServices.InternalsVisibleTo">
        <_Parameter1>$(MSBuildProjectName).Tests</_Parameter1>
      </AssemblyAttribute>
    </ItemGroup>
  </Target>

  <Import Project="Sign.targets" Condition="'$(SignTargetsImported)' == ''" />
  <Import Project="Wim.targets"  Condition="'$(WimTargetsImported)'  == ''" />
  <Import Project="Zip.targets"  Condition="'$(ZipTargetsImported)'  == ''" />

  <Target Name="DeleteProjectAssets" BeforeTargets="Clean" Condition="'$(BuildingInsideVisualStudio)' == ''">
    <Delete Files="obj\project.assets.json" />
  </Target>

  <Target Name="TraceDirectoryBuildDefaultTargets" Condition="'$(ZouTrace)' == 'true'">
    <Message Importance="high" Text="zou/Directory.Build.Default.targets [$(MSBuildProjectFile)]" />
    <Message Importance="high" Text="-----------------------------------" />
    <Message Importance="high" Text="ProjectName               = $(ProjectName)" />
    <Message Importance="high" Text="MSBuildRuntimeType        = $(MSBuildRuntimeType)" />
    <Message Importance="high" Text="TargetFrameworkImport     = $(TargetFrameworkImport)" />
    <Message Importance="high" Text="TargetFramework           = $(TargetFramework)" />
    <Message Importance="high" Text="TargetFrameworks          = $(TargetFrameworks)" />
    <Message Importance="high" Text="TargetFrameworkIdentifier = $(TargetFrameworkIdentifier)" />
    <Message Importance="high" Text="TargetFrameworkVersion    = $(TargetFrameworkVersion)" />
    <Message Importance="high" Text=" " />
  </Target>
</Project>
