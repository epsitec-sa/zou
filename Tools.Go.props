<Project InitialTargets="ToolsGoTrace">

  <PropertyGroup>
    <GoGetRoot Condition="'$(GoGetRoot)' == ''">git.epsitec.ch/epsitec</GoGetRoot>
    <GoProjectDir>$(GOPATH)\src\$(GoGetRoot)\$(BundleRelativeProjectDir)</GoProjectDir>
    <GoOutDir>$(GoProjectDir)bin\$(Platform)\</GoOutDir>
    <GoBinDir>$([System.IO.Path]::Combine($(GOPATH),'bin'))</GoBinDir>
    <GoSrcDir>$([System.IO.Path]::Combine($(GOPATH),'src'))</GoSrcDir>
    
    <GoOS Condition="$([MSBuild]::IsOSPlatform(OSX))">darwin</GoOS>
    <GoOS Condition="$([MSBuild]::IsOSPlatform(Linux))">linux</GoOS>
    <GoOS Condition="'$(GoOS)' == ''">windows</GoOS>
    <GoArch Condition="'$(Platform)' == 'Win32' Or '$(Platform)' == 'x86'">386</GoArch>
    <GoArch Condition="'$(GoArch)' == ''">amd64</GoArch>
    <GoExecPath>$(MSysPath);$(PATH)</GoExecPath>
    <GoExecPath>$(GoExecPath.Replace(';', '%3B'))</GoExecPath>
    
    <CGoEnabled Condition="'$(CGoEnabled)' == ''">1</CGoEnabled>
  </PropertyGroup>

  <ItemGroup>
    <GoBuildEnv Include="GOOS=$(GoOS)" />
    <GoBuildEnv Include="GOARCH=$(GoArch)" />
    <GoBuildEnv Include="CGO_ENABLED=$(CGoEnabled)" />
    <GoBuildEnv Include="CC=$(MSysGcc)" />
    <GoBuildEnv Include="PATH=$(GoExecPath)" />
  </ItemGroup>

  <Target Name="CheckGoEnv" BeforeTargets="Build">
    <Error Text="Go programming language not installed" Condition="'$(GOROOT)' == '' Or !$([System.IO.File]::Exists($(GOROOT)\bin\go.exe))" />
    <Error Text="GOPATH environment variable not set" Condition="'$(GOPATH)' == ''" />
  </Target>

  <Target Name="ToolsGoTrace" Condition="'$(ZouTraceProps)' == 'true'">
    <Message Importance="normal" Text="GoProjectDir = $(GoProjectDir)" />
    <Message Importance="normal" Text="GoOutDir     = $(GoOutDir)" />
    <Message Importance="normal" Text="GOROOT       = $(GOROOT)" />
    <Message Importance="normal" Text="GOPATH       = $(GOPATH)" />
    <Message Importance="normal" Text="GoBinDir     = $(GoBinDir)" />
    <Message Importance="normal" Text="GoSrcDir     = $(GoSrcDir)" />
    <Message Importance="normal" Text="GoOS         = $(GoOS)" />
    <Message Importance="normal" Text="GoArch       = $(GoArch)" />
    <Message Importance="normal" Text="CGoEnabled   = $(CGoEnabled)" />
    <Message Importance="normal" Text="GoBuildEnv   = %(GoBuildEnv.Identity)" />
  </Target>
</Project>