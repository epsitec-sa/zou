<?xml version="1.0" encoding="utf-8"?>
<!--
This script can be imported anywhere before first MS import (Microsoft.Cpp.Default.props).
Import this script at the beginning of other scripts to define global zou properties:

  <Project ... >
    <Import Condition="'$(Zou)' == ''" Project="zou.props"/>
    ...
  </Project>

ZouDir     : the path of the 'zou' folder.
BundleName : the bundle name.
BundleDir  : the path of the bundle root folder. (The bundle folder is the one where `zou` and `git` repositories are located.)
-->
<Project ToolsVersion="4.0" xmlns="http://schemas.microsoft.com/developer/msbuild/2003">
  <!-- Import semaphore -->
  <PropertyGroup> <Zou>zou</Zou> </PropertyGroup>
  
  <PropertyGroup>
    <!-- Configuration sub-directory -->
    <_ZouCfgSubdir>zou.cfg\</_ZouCfgSubdir>
  </PropertyGroup>

  <PropertyGroup>
    <ZouDir>$([System.IO.Directory]::GetParent($(MSBuildThisFileDirectory)).FullName)\</ZouDir>
    <BundleName>$([System.IO.Directory]::GetParent($(MSBuildThisFileDirectory)).Parent.Name)</BundleName>
    <BundleDir>$([System.IO.Directory]::GetParent($(MSBuildThisFileDirectory)).Parent.FullName)\</BundleDir>

    <ZouPrivateDir>$(ZouDir)private\</ZouPrivateDir>
  </PropertyGroup>

  <!-- ZouBundleDir -->
  <PropertyGroup Condition="'$(ZouBundleDir)' == ''" >
    <ZouBundleDir>$(BundleDir)$(_ZouCfgSubdir)</ZouBundleDir>
  </PropertyGroup>

  <!-- Project properties -->
  <PropertyGroup Condition="'$(ZouProjectDir)' == ''" >
    <ZouProjectDir>$(MSBuildProjectDirectory)\$(_ZouCfgSubdir)</ZouProjectDir>
  </PropertyGroup>
  <PropertyGroup>
    <BundleRelativeProjectDir>$([MSBuild]::MakeRelative($(BundleDir), $(MSBuildProjectDirectory)\))</BundleRelativeProjectDir>
    <BundleRelativeProjectName>$([MSBuild]::MakeRelative($(BundleDir), $(MSBuildProjectDirectory)\$(MSBuildProjectName)))</BundleRelativeProjectName>
    <BundleRelativeProjectPath>$([MSBuild]::MakeRelative($(BundleDir), $(MSBuildProjectDirectory)\$(MSBuildProjectFile)))</BundleRelativeProjectPath>
    <_ZouBackSlashPos>$(BundleRelativeProjectPath.IndexOf('\'))</_ZouBackSlashPos>
  </PropertyGroup>
  <PropertyGroup Condition="'$(_ZouBackSlashPos)' &gt; '0'" >
    <BundleProjectAnchor>$(BundleRelativeProjectPath.Substring(0, $(_ZouBackSlashPos)))\</BundleProjectAnchor>
  </PropertyGroup>

  <!-- Solution properties -->
  <Choose>
    <When Condition="'$(SolutionPath)' != '' And '$(SolutionPath)' != '*Undefined*'">
      <PropertyGroup Condition="'$(ZouSolutionDir)' == ''" >
        <ZouSolutionDir>$(SolutionDir)$(_ZouCfgSubdir)</ZouSolutionDir>
      </PropertyGroup>
      <PropertyGroup>
        <BundleRelativeSolutionDir>$([MSBuild]::MakeRelative($(BundleDir), $(SolutionDir)))</BundleRelativeSolutionDir>
        <BundleRelativeSolutionName>$([MSBuild]::MakeRelative($(BundleDir), $(SolutionDir)$(SolutionName)))</BundleRelativeSolutionName>
        <BundleRelativeSolutionPath>$([MSBuild]::MakeRelative($(BundleDir), $(SolutionPath)))</BundleRelativeSolutionPath>
        <_ZouBackSlashPos>$(BundleRelativeSolutionPath.IndexOf('\'))</_ZouBackSlashPos>
      </PropertyGroup>
      <PropertyGroup Condition="'$(_ZouBackSlashPos)' &gt; '0'" >
        <BundleSolutionAnchor>$(BundleRelativeSolutionPath.Substring(0, $(_ZouBackSlashPos)))\</BundleSolutionAnchor>
      </PropertyGroup>
    </When>
    <Otherwise>
      <PropertyGroup>
        <ZouSolutionDir>$(ZouProjectDir)</ZouSolutionDir>
        <BundleRelativeSolutionDir>$(BundleRelativeProjectDir)</BundleRelativeSolutionDir>
        <BundleSolutionAnchor>$(BundleProjectAnchor)</BundleSolutionAnchor>
      </PropertyGroup>
    </Otherwise>
  </Choose>

  <Target Name="ZouTraceMSBuild">
    <Message Importance="high" Text="MSBuild properties" />
    <Message Importance="high" Text="==================" />
    <Message Importance="normal" Text="  MSBuildBinPath                 = $(MSBuildBinPath)" />
    <Message Importance="normal" Text="  MSBuildToolsPath               = $(MSBuildToolsPath)" />
    <Message Importance="normal" Text="  MSBuildExtensionsPath          = $(MSBuildExtensionsPath)" />
    <Message Importance="normal" Text="  MSBuildExtensionsPath32        = $(MSBuildExtensionsPath32)" />
    <Message Importance="normal" Text="  MSBuildExtensionsPath64        = $(MSBuildExtensionsPath64)" />
    <Message Importance="normal" Text="  MSBuildToolsVersion            = $(MSBuildToolsVersion)" />
    <Message Importance="normal" Text="  MSBuildFrameworkToolsPath      = $(MSBuildFrameworkToolsPath)" />
    <Message Importance="normal" Text="  MSBuildLastTaskResult          = $(MSBuildLastTaskResult)" />
    <Message Importance="normal" Text="  MSBuildProjectDirectory        = $(MSBuildProjectDirectory)" />
    <Message Importance="normal" Text="  MSBuildProjectFile             = $(MSBuildProjectFile)" />
    <Message Importance="normal" Text="  MSBuildThisFile                = $(MSBuildThisFile)" />
    <Message Importance="normal" Text="  MSBuildThisFileDirectory       = $(MSBuildThisFileDirectory)" />
    <Message Importance="normal" Text="  MSBuildThisFileExtension       = $(MSBuildThisFileExtension)" />
    <Message Importance="normal" Text="  MSBuildThisFileFullPath        = $(MSBuildThisFileFullPath)" />
    <Message Importance="normal" Text="  MSBuildThisFileName            = $(MSBuildThisFileName)" />
    <Message Importance="normal" Text="  MSBuildThisFileDirectoryNoRoot = $(MSBuildThisFileDirectoryNoRoot)" />
    <Message Importance="normal" Text="  VCTargetsPath                  = $(VCTargetsPath)" />
  </Target>
  
  <Target Name="ZouTrace">
    <Message Importance="high" Text="Zou boot properties" />
    <Message Importance="high" Text="===================" />
    <Message Importance="normal" Text="  SolutionName               = $(SolutionName)" />
    <Message Importance="normal" Text="  SolutionDir                = $(SolutionDir)"  />
    <Message Importance="normal" Text="  SolutionPath               = $(SolutionPath)" />
    <Message Importance="normal" Text="  MSBuildProjectName         = $(MSBuildProjectName)" />
    <Message Importance="normal" Text="  MSBuildProjectDirectory    = $(MSBuildProjectDirectory)" />
    <Message Importance="normal" Text="  MSBuildProjectFile         = $(MSBuildProjectFile)" />
    <Message Importance="normal" Text="+ BundleName                 = $(BundleName)"   />
    <Message Importance="normal" Text="+ BundleDir                  = $(BundleDir)"    />
    <Message Importance="normal" Text="+ ZouDir                     = $(ZouDir)" />
    <Message Importance="normal" Text="+ ZouPrivateDir              = $(ZouPrivateDir)" />
    <Message Importance="normal" Text="+ ZouBundleDir               = $(ZouBundleDir)"   />
    <Message Importance="normal" Text="+ ZouSolutionDir             = $(ZouSolutionDir)" />
    <Message Importance="normal" Text="+ ZouProjectDir              = $(ZouProjectDir)"  />
    <Message Importance="normal" Text="+ BundleRelativeSolutionDir  = $(BundleRelativeSolutionDir)" />
    <Message Importance="normal" Text="+ BundleRelativeSolutionName = $(BundleRelativeSolutionName)" />
    <Message Importance="normal" Text="+ BundleRelativeSolutionPath = $(BundleRelativeSolutionPath)" />
    <Message Importance="normal" Text="+ BundleRelativeProjectDir   = $(BundleRelativeProjectDir)"  />
    <Message Importance="normal" Text="+ BundleRelativeProjectName  = $(BundleRelativeProjectName)"  />
    <Message Importance="normal" Text="+ BundleRelativeProjectPath  = $(BundleRelativeProjectPath)"  />
    <Message Importance="normal" Text="+ BundleSolutionAnchor       = $(BundleSolutionAnchor)"       />
    <Message Importance="normal" Text="+ BundleProjectAnchor        = $(BundleProjectAnchor)"        />
    <Message Importance="high" Text="Evaluation time" />
    <Message Importance="high" Text="===============" />
    <Message Importance="normal" Text="  Configuration              = $(Configuration0)"   />
    <Message Importance="normal" Text="  Platform                   = $(Platform0)"        />
    <Message Importance="normal" Text="  PlatformToolset            = $(PlatformToolset0)" />
    <Message Importance="normal" Text="  SolutionName               = $(SolutionName0)" />
    <Message Importance="normal" Text="  SolutionDir                = $(SolutionDir0)"  />
    <Message Importance="normal" Text="  SolutionPath               = $(SolutionPath0)" />
    <Message Importance="normal" Text="  ProjectName                = $(ProjectName0)"  />
    <Message Importance="normal" Text="  ProjectDir                 = $(ProjectDir0)"   />
    <Message Importance="normal" Text="  ProjectPath                = $(ProjectPath0)"  />
    <Message Importance="normal" Text="  IntDir                     = $(IntDir0)"          />
    <Message Importance="normal" Text="  OutDir                     = $(OutDir0)"          />
    <Message Importance="normal" Text="  TargetDir                  = $(TargetDir0)"       />
    <Message Importance="normal" Text="  OutputPath                 = $(OutputPath0)"  />
    <Message Importance="normal" Text="%0A" />
    <Message Importance="high" Text="Target time" />
    <Message Importance="high" Text="===========" />
    <Message Importance="normal" Text="  Configuration              = $(Configuration)"   />
    <Message Importance="normal" Text="  Platform                   = $(Platform)"        />
    <Message Importance="normal" Text="  PlatformToolset            = $(PlatformToolset)" />
    <Message Importance="normal" Text="  SolutionName               = $(SolutionName)" />
    <Message Importance="normal" Text="  SolutionDir                = $(SolutionDir)"  />
    <Message Importance="normal" Text="  SolutionPath               = $(SolutionPath)" />
    <Message Importance="normal" Text="  ProjectName                = $(ProjectName)"  />
    <Message Importance="normal" Text="  ProjectDir                 = $(ProjectDir)"   />
    <Message Importance="normal" Text="  ProjectPath                = $(ProjectPath)"  />
    <Message Importance="normal" Text="  IntDir                     = $(IntDir)"          />
    <Message Importance="normal" Text="  OutDir                     = $(OutDir)"          />
    <Message Importance="normal" Text="  TargetDir                  = $(TargetDir)"       />
    <Message Importance="normal" Text="  OutputPath                 = $(OutputPath)"  />
  </Target>
</Project>