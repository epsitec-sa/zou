<!--
Import this script at the beginning of a C# redist agent

This script imports a chain of 'zou.redist.props' in which we can define
properties to control the 'Redist.targets' build settings.

    RedistProjectPath  - [required] - the path of the project script                         - ex: Net\Swissdec.Transmitter.Host\Swissdec.Transmitter.Host.csproj
                                      relative to the 'zou.redist.props' directory
    RedistFolder       - [optional] - append a component folder to the output directory      - ex: bin\Release\win-x64\<redist-folder>
    RedistByFramework  - [optional] - include the target framework   in the output directory - ex: bin\Release\net6[\win-x64]\<redist-folder>
    RedistByRuntime    - [optional] - include the runtime identifier in the output directory - ex: bin\Release\[net6\]win-x64\<redist-folder>
    RedistX86Framework - [optional] - the target framework used for x86 or AnyCPU platforms  - (CoreTargetFramework | FullTargetFramework)
    RedistX64Framework - [optional] - the target framework used for x64 platform             - (CoreTargetFramework | FullTargetFramework)
-->
<Project TreatAsLocalProperty="ZouRedistPath;RedistFolder;RedistDebug;CrossBuild">

  <PropertyGroup>
    <!-- Inform agents that we are in redistribution mode -->
    <RedistMode>true</RedistMode>
  </PropertyGroup>
  
  <Import Project="zou.props"           Condition="'$(ZouVersion)' == ''" />
  <Import Project="Cs.Frameworks.props" Condition="'$(CoreTargetFramework)' == ''" />

  <!-- Import the first 'zou.redist.props' found in the local project directory or above -->
  <PropertyGroup>
    <ZouRedistPath>$([MSBuild]::GetPathOfFileAbove('zou.redist.props', '$(MSBuildProjectDirectory)'))</ZouRedistPath>
  </PropertyGroup>
  <Import Project="$(ZouRedistPath)" Condition="Exists('$(ZouRedistPath)')" />

  <PropertyGroup>
    <RedistDebug Condition="'$(RedistDebug)' == ''">false</RedistDebug>
  </PropertyGroup>
  
  <!-- Limit cross-build -->
  <PropertyGroup>
    <!-- FullTargetFramework is not available on OSX and Linux -->
    <CrossBuild Condition="'$(RedistX64Framework)' == '$(FullTargetFramework)'">false</CrossBuild>
  </PropertyGroup>
</Project>
