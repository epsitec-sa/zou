<?xml version="1.0" encoding="utf-8"?>
<!-- Import this script at the end of the C# interop project -->
<Project ToolsVersion="4.0" xmlns="http://schemas.microsoft.com/developer/msbuild/2003" DefaultTargets="GetTextBuild">

  <!-- Make sure that ImportProject is available in VisualStudio's Build Action combo -->
  <ItemGroup>
    <AvailableItemName Include="GetText" />
  </ItemGroup>

  <Import Project="Cs.Boot.props"/>
  <Import Project="Com.WorkDir.props"/>

  <!-- Create list of .cs file for xgettext -->
  <Target Name="GetCsFiles">
    <ItemGroup>
      <CsFile Include="%(ProjectReference.RootDir)%(Directory)**\*.cs" Exclude="%(RootDir)%(Directory)obj\**\*.cs" />
    </ItemGroup>
    <Message Importance="high" Text="%(CsFile.Identity)" />
  </Target>

  <!-- Save list of .cs file -->
  <PropertyGroup>
    <XGetTextInputPath>$([System.IO.Path]::Combine($(ProjectDir),$(IntermediateOutputPath)))xgettext_input.txt</XGetTextInputPath>
    <!--<XGetTextOutputPath>$([System.IO.Path]::Combine($(ProjectDir),$(OutputPath)))$(ProjectName).pot</XGetTextOutputPath>-->
  </PropertyGroup>
  <Target Name="SaveCsFiles" DependsOnTargets="GetCsFiles">
    <WriteLinesToFile File="$(XGetTextInputPath)" Lines="@(CsFile)" Overwrite="true" />
    <!-- TODO - FOR TEST ONLY: open in default editor -->
    <Exec Command='"$(XGetTextInputPath)"' />
  </Target>

  <!-- Create .pot file -->
  <Target Name="XGetText" DependsOnTargets="SaveCsFiles">
    <Exec Command='"$(ZouDir)gettext\xgettext" -k_ --from-code utf-8 -d Sync -L C# --no-wrap -f "$(XGetTextInputPath)" -o "$(XGetTextOutputPath)"' />
  </Target>
  <Target Name="Debug">
    <LogItems Title="ProjectReference" Items="@(ProjectReference)" AllMetadata="true" />
    <!--<LogItems Title="CsFile" Items="@(CsFile)" />-->
  </Target>

  <Target Name="GetTextBuild" BeforeTargets="Build" DependsOnTargets="XGetText" />
  <Target Name="GetTextClean" AfterTargets="Clean" />

  <Import Project="ImportProject.targets" />
</Project>