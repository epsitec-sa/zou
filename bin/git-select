#!/bin/bash

. zoul-git-branch-select

forOpts=()
while [[ "$#" > 0 ]]; do case "$1" in
  --) shift; args+=("$@"); break;;
  -h|--help) zou-help $0; exit 0;;
  -q|--quiet) quiet=true; forOpts+=($1);;
  -e|--stop-on-error) forOpts+=($1);;
  -*) echo "unknown option: $1" >&2; exit 1;;
  *) branch=$1;;
esac; shift; done

if repo_is_submodule_level1; then
  [[ -z $branch ]] && branch=$(branch_current_root_branch)
  branch_select $branch
  repo_update_submodules
  repo_commit_submodules
elif repo_is_root; then
  [[ -z $quiet ]] && echo "Entering $(basename `pwd`)"
  [[ -z $branch ]] && branch=$(branch_current)
  branch_select $branch
  git for -s ${forOpts[@]} git select
  repo_commit_submodules
else
  exit 1
fi
