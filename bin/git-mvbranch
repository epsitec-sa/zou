#!/bin/bash

[[ -z $ZOUL_GIT_BRANCH_CORE ]] && . zoul-git-branch-core
[[ -z $ZOUL_GIT_REPO ]]        && . zoul-git-repo
[[ -z $ZOUL_GIT_MODULE ]]      && . zoul-git-module

mvbranch_parse()
{
  while [[ "$#" > 0 ]]; do case "$1" in
    -h|--help) zou-help $0; exit 0;;
    --debug) debug=true;;
    -*) io_error "unknown option: $1"; exit 1;;
    *) args+=("$1");;
  esac; shift; done
}
mvbranch_run()
{
  local args=()
  mvbranch_parse "$@"
  module_run mvbranch_main "${args[@]}"
}
mvbranch_main()
{
  repo_require_clean_work_tree 'Cannot move branch[es]'

  local branch1=$1 branch2=$2 branch
  if ! branch_move $branch1 $branch2; then
    # assume branch1 and branch2 are folders
    for branch in $(branch_list_all_flatten); do
      if [[ $branch =~ ^${branch1%/}(/[^/]+$) ]]; then
        branch_move $branch ${branch2%/}${BASH_REMATCH[1]}
      fi
    done
  fi
}
mvbranch_run "$@"
