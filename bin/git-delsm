#!/bin/bash

while [[ "$#" > 0 ]]; do case "$1" in
  -h|--help) zou-help $0; exit 0;;
  --) args+=( "$@" ); break;;
  -k|--keep-work) keepWork=true;;
  -*) io_error "unknown option: $1"; exit 1;;
  *) args+=("$1");;
esac; shift; done

for sm in "${args[@]}"; do
  echo Removing "$sm" submodule...
  git config --file '.gitmodules' --remove-section "submodule.$sm" &>/dev/null
  git update-index --add -- '.gitmodules' &>/dev/null
  git submodule deinit -f -- "$sm" &>/dev/null
  git rm --cached "$sm" &>/dev/null
  if [[ $keepWork == true ]]; then
    rm "$sm/.git"
  else
    rm -rf "$sm"
  fi
done