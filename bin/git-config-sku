#!/bin/bash

. zoul-git-config-sku

mode='status'
include=()
exclude=()
while [[ "$#" > 0 ]]; do case "$1" in
  --) shift; args+=("$@"); break;;
  -h|--help) zou-help $0; exit 0;;
  --include) mode='include';;
  --exclude) mode='exclude';;
  --branch)  branch=$1;;
  -*) echo "unknown option: $1" >&2; exit 1;;
  *)
    case "$mode" in
      include) include+=($1);;
      exclude) exclude+=($1);;
    esac
esac; shift; done

[[ -z $branch ]] && branch=$(branch_ensure_current)
configFile=$(repo_zouflow_path)

for path in "${include[@]}"; do
  config_sku_include "$path" "$branch" "$configFile"
done
for path in "${exclude[@]}"; do
  config_sku_exclude "$path" "$branch" "$configFile"
done

case "$mode" in
  include) [ ${#include[@]} -eq 0 ] && config_sku_include_all "$branch" "$configFile";;
  exclude) [ ${#exclude[@]} -eq 0 ] && config_sku_exclude_all "$branch" "$configFile";;
  status) config_sku_status "$branch" "$configFile";;
esac
