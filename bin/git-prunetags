#!/bin/bash

[[ -z $ZOUL_GIT_MODULE ]] && . zoul-git-module

ptags_parse()
{
  while [[ "$#" > 0 ]]; do case "$1" in
    -h|--help) zou-help $0; exit 0;;
    .)  unset recursive;;
    -*) forOpts+=($1);;
  esac; shift; done
}
ptags_run()
{
  local recursive=true forOpts=()
  ptags_parse "$@" || return $?

  if [[ $recursive = true ]]; then
    . git-for "${forOpts[@]}" -- 'ptags_node'
  else
    module_run ptags_node
  fi
}
ptags_node()
{

  local tag line
  io_info "Deleting local tags..." "$moduleTracePrefix"
  for tag in $(git tag --list); do
    git tag --delete $tag &>/dev/null
  done
  io_info "Fetching remote tags..." "$moduleTracePrefix"
  (git fetch --tags 2>&1) | \
  while read line; do
    [[ -z $line ]] && continue
    [[ $line =~ ^.*\[new\ tag\][[:blank:]]+(.*)$ ]] && {
      io_message "  ${BASH_REMATCH[1]}" "$moduleTracePrefix" LightGray
    }
  done
}

ptags_run "$@"

