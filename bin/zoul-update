#!/bin/bash

while [[ "$#" > 0 ]]; do case "$1" in
  -r|--reset) resetConfig=true;;
  -f|--fast)  fast=true;;
  -*) echo "unknown option: $1" >&2; exit 1;;
esac; shift; done

[[ -z $ZOUL_GIT_REPO ]] && . zoul-git-repo
[[ -z $ZOUL_CONFIG ]]   && . zoul-config

zou_update()
{
  local sku=$1

  [[ $resetConfig == true ]] && config_reset
  config_setup

  local broot=$(repo_bundle_root)

  if [[ $fast == true || "$broot" == "$PWD" ]]; then
    # zou repo alone, fetch has already been done
    git select -q "$sku"
  else
    # zou repo inside zou-dev bundle, synchronize and select all
    local opwd=$PWD
    cd "$broot"
    git checkout "$sku"
    git pull
    git select -q "$sku"
    cd "$opwd"
  fi
}

zou_update 'wip/zou/git-commands'