#!/bin/bash

[[ -z $ZOUL_GIT_MODULE ]]      && . zoul-git-module
[[ -z $ZOUL_GIT_VTAG ]]        && . zoul-git-vtag
[[ -z $ZOUL_GIT_BRANCH_CORE ]] && . zoul-git-branch-core

attach_parse()
{
  while [[ "$#" > 0 ]]; do case "$1" in
    -h|--help) zou-help $0; exit 0;;
    .)  unset recursive;;
    -*) forOpts+=($1);;
  esac; shift; done
}
attach_run()
{
  local recursive=true forOpts=()
  attach_parse "$@" || return $?

  module_run attach_main
}
attach_main()
{
  [ ${#moduleSubmodulePaths[@]} -eq 0 ] && unset recursive

  if [[ $recursive = true ]]; then
    . git-for "${forOpts[@]}" -- 'attach_node'
  else
    module_run attach_node
  fi
}
attach_node()
{
  local vtag delta alias
  vtag_set_info $(vtag_describe HEAD)
  branch_try_attach 'HEAD' '' true "$alias"
}

attach_run "$@"
