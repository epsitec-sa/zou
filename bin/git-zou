#!/bin/bash

while [[ "$#" > 0 ]]; do case "$1" in
  -h|--help) zou-help $0; exit 0;;
  -r|--reset) resetConfig=true;;
  -*) echo "unknown option: $1" >&2; exit 1;;
esac; shift; done

zou_dir="$( cd "$( dirname "${BASH_SOURCE[0]}" )" >/dev/null && realpath `pwd`/.. )"
opwd=$PWD; cd "$zou_dir"

if test -n "$(git status --porcelain)"; then
  printf '\033[0;31m%b\033[0m' "error: repo '$zou_dir' is not clean, aborting...\n"
else
  git fetch --prune --all &>/dev/null
  git fetch --tags --force &>/dev/null

  . zoul-config
  [[ $resetConfig == true ]] && config_reset
  config_setup

  . zoul-update
  zou_update
fi

cd "$opwd"
