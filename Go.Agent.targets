<Project>

  <ItemGroup>
    <GoBuild Include="$(GoWorkspace)**\*.go"  />
    <GoBuild Include="$(GoWorkspace)**\*.h" />
    <GoBuild Include="$(GoWorkspace)**\*.c" />
    <GoResource Include="$(GoResourceDir)**\*" />
  </ItemGroup>

  <Target Name="GoBuildVersionInfo" DependsOnTargets="GoGetTools" BeforeTargets="Build">
    <PropertyGroup>
      <GoVerInfoFlags Condition="$(Platform.EndsWith('x64'))">-64</GoVerInfoFlags>
      <GoVerInfoFlags Condition="Exists('$(TargetFileName).$(Configuration).manifest')">$(GoVerInfoFlags) -manifest="$(TargetFileName).$(Configuration).manifest"</GoVerInfoFlags>
    </PropertyGroup>
    <Exec Command="$(GoVerInfoPath) $(GoVerInfoFlags)"
          WorkingDirectory="$(ProjectDir)"
          EnvironmentVariables="@(GoBuildEnv)"
          StandardOutputImportance='low' />
  </Target>

  <Target Name="Build" Inputs="@(GoBuild);@(GoResource)" Outputs="$(TargetPath)">
    <Delete Files="$(TargetPath);@(TargetName->'$(TargetDir)%(Identity)$(TargetExt)')" />
    <Message Importance="high" Text="go generate [$(ProjectPath)]" />
    <Exec Command="go generate"
          WorkingDirectory="$(ProjectDir)"
          EnvironmentVariables="@(GoBuildEnv);TARGETPATH=$(TargetPath)"
          StandardOutputImportance='low' />
    <Message Condition="'@(TargetName->Count())'=='0'" Importance="high" Text="$(ProjectName) -> $(TargetPath)" />
    <Message Condition="'@(TargetName->Count())'!='0'" Importance="high" Text="$(ProjectName) -> $(TargetDir)%(TargetName.Identity)$(TargetExt)" />
  </Target>

  <Target Name="Clean">
    <Exec WorkingDirectory="$(ProjectDir)" Command="go clean" />
    <Delete Files="$(TargetPath);@(TargetName->'$(TargetDir)%(Identity)$(TargetExt)')" />
  </Target>

</Project>
