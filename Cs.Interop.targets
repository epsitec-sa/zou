<!--
Layout:
=======

  {native-project}
    Win32\v120_xp\bin\Debug\{native-files}

  where:
    Win32     $(InteropPlatform)
    v120_xp   $(PlatformToolset)
    
  ====
  
  {mixed-platform-solution}
    Win32\Interop\{native-project-name}\Debug\{native-files}
      
  {managed-project}
    bin\Debug\{native-files}

  where:
    Win32     $(InteropPlatform)
    
-->
<Project>

  <!-- Make sure that ImportProject is available in VisualStudio's Build Action combo -->
  <ItemGroup>
    <AvailableItemName Include="ImportProject" />
  </ItemGroup>

  <Import Project="Com.WorkDir.props"/>
  <Import Project="Com.InteropPlatform.props" />

  <PropertyGroup>
    <TargetFrameworks />
  </PropertyGroup>
  
  <ItemDefinitionGroup>
    <ImportProject>
      <Platform>$(InteropPlatform)</Platform>
      <OutDir>$(WorkDir)$(InteropPlatform)\Interop\%(FileName)\$(Configuration)\</OutDir>
    </ImportProject>
  </ItemDefinitionGroup>
  
  <Import Project="ImportProject.targets" />
  
  <Target Name="_ImportProject">
    <Message Condition="'$(ZouDebug)' == 'true'" Importance="high" Text="### [$(MSBuildProjectFile)] CsInterop._ImportProject" />
  </Target>
  <Target Name="_ImportProjectClean">
    <Message Condition="'$(ZouDebug)' == 'true'" Importance="high" Text="### [$(MSBuildProjectFile)] CsInterop._ImportProjectClean" />
  </Target>

  <Target Name="CreateInteropContent" DependsOnTargets="ImportProject">
    <Message Condition="'$(ZouDebug)' == 'true'" Importance="high" Text="### [$(MSBuildProjectFile)] CreateInteropContent" />
    <ItemGroup>
      <InteropContent Include="%(ImportProject.OutDir)**" />
      <InteropContent>
        <Link>%(InteropContent.RecursiveDir)%(FileName)%(Extension)</Link>
        <CopyToOutputDirectory>PreserveNewest</CopyToOutputDirectory>
        <Visible>false</Visible>
      </InteropContent>
      <Content Include="@(InteropContent)" />
    </ItemGroup>
    <!--<LogItems Items="@(InteropContent)" Title="InteropContent" />
    <Message Importance="high"  Text=" " />-->
  </Target>

  <Target Name="InteropBuild" BeforeTargets="Build" DependsOnTargets="CreateInteropContent" Condition="'$(DesignTimeBuild)' != 'true' And '$(BuildingProject)' == 'true'">
    <Message Condition="'$(ZouDebug)' == 'true'" Importance="high" Text="### [$(MSBuildProjectFile)] InteropBuild" />
  </Target>
  <Target Name="InteropClean" BeforeTargets="Clean" DependsOnTargets="ImportProjectInit">
    <Message Condition="'$(ZouDebug)' == 'true'" Importance="high" Text="### [$(MSBuildProjectFile)] InteropClean(%(ImportProject.OutDir))" />
    <ItemGroup>
      <InteropClean Include="%(ImportProject.OutDir)**" />
    </ItemGroup>
    <!--<LogItems Items="@(InteropClean)" Title="InteropClean" />
    <Message Importance="high"  Text=" " />-->
    <Delete Files="@(InteropClean)" />
  </Target>
</Project>
