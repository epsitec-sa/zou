<?xml version="1.0" encoding="utf-8"?>
<!-- Import this script at the end of the C# interop project -->
<Project ToolsVersion="4.0" xmlns="http://schemas.microsoft.com/developer/msbuild/2003" DefaultTargets="InteropBuild">

  <!-- Make sure that ImportProject is available in VisualStudio's Build Action combo -->
  <ItemGroup>
    <AvailableItemName Include="ImportProject" />
  </ItemGroup>

  <Import Project="Cs.Boot.props" Condition="'$(CsBootImported)' != 'true'"/>
  <Import Project="Com.WorkDir.props"/>
  <Import Project="Com.InteropPlatform.props" />

  <ItemDefinitionGroup>
    <ImportProject>
      <Platform>$(InteropPlatform)</Platform>
      <OutDir>$(WorkDir)$(InteropPlatform)\Interop\%(FileName)\$(Configuration)\</OutDir>
    </ImportProject>
  </ItemDefinitionGroup>
  
  <!-- Import interop components -->
  <Target Name="GetInteropFiles" Condition="'@(ImportProject)' != ''">
    <ItemGroup>
      <InteropFile Include="%(ImportProject.OutDir)**\*.*" />
    </ItemGroup>
    <LogItems Items="@(ImportProject)" Title="ImportProject"/>
    <!--<LogItems Items="@(InteropFile)" Title="InteropFile"/>-->
  </Target>
  
  <Target Name="CreateInteropContent"
          DependsOnTargets="GetInteropFiles"
          Inputs="@(InteropFile)"
          Outputs="@(InteropFile->'$(TargetDir)%(RecursiveDir)%(FileName)%(Extension)')">
    <ItemGroup>
      <Content Include="@(InteropFile)">
        <CopyToOutputDirectory>PreserveNewest</CopyToOutputDirectory>
        <Visible>false</Visible>
      </Content>
    </ItemGroup>
    <Message Importance="high" Text="  [i] %(InteropFile.Identity) -&gt; $(TargetDir)%(RecursiveDir)%(FileName)%(Extension)" />
  </Target>

  <Target Name="InteropBuild" BeforeTargets="BeforeBuild" DependsOnTargets="ImportProject;CreateInteropContent" />
  <Target Name="InteropClean" AfterTargets="AfterClean"   DependsOnTargets="ImportProjectClean" />

  <Import Project="ImportProject.targets" />
</Project>